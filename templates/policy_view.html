{% extends "base.html" %}

{% block title %}Policy Details - {{ policy.PolicyNumber }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>Policy Details: {{ policy.PolicyNumber }}</h2>
        <p class="text-muted">Client: {{ policy.Nom }} {{ policy.Prenom }} | NIF: {{ policy.NIF or 'N/A' }}</p>
    </div>
    <div>
        <a href="{{ url_for('edit_policy', policy_id=policy.PolicyID) }}" class="btn btn-warning">
            <i class="fas fa-edit me-2"></i>Edit Policy
        </a>
        <a href="{{ url_for('client_policies', client_id=policy.ClientID) }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Policies
        </a>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file-contract me-2"></i>Policy Information</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Basic Information -->
                    <div class="col-md-6">
                        <h6 class="text-bicor mb-3 border-bottom pb-2">Basic Information</h6>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Policy Number:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.PolicyNumber }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Product:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.ProductName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Event Type:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.EventName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Policy Type:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.PolicyTypeName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Option:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.OptionName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Courtier (Broker):</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.CourtierName or '---' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Dates and Terms -->
                    <div class="col-md-6">
                        <h6 class="text-bicor mb-3 border-bottom pb-2">Dates & Terms</h6>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Production Date:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.ProductionDate }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Expiry Date:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.ExpiryDate }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Duration:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">
                                    {% if policy.DurationMonths %}
                                        {{ policy.DurationMonths }} months
                                    {% else %}
                                        ---
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Term:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.TermName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Status:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="badge bg-{% if policy.Status == 'Active' %}success{% else %}warning{% endif %}">
                                    {{ policy.Status }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reference Numbers -->
                <hr>
                <h6 class="text-bicor mb-3 border-bottom pb-2">Reference Numbers</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Old Policy Number:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.OldPolicyNumber or '---' }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Endorsement Number:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.EndorsementNumber or '---' }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Other Endorsement No.:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.OtherEndorsementNumber or '---' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Purchase Information -->
                <hr>
                <h6 class="text-bicor mb-3 border-bottom pb-2">Purchase Information</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Purchase Order:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.PurchaseOrder or '---' }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">PO Number:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.PurchaseOrderNumber or '---' }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Credit Authorized By:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.CreditAuthorizedBy or '---' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agency and Creation Info -->
                <hr>
                <h6 class="text-bicor mb-3 border-bottom pb-2">Agency & Creation Information</h6>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Agency:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.AgencyName }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Created By:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.CreatedByName }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Created On:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.CreatedOn }}</span>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-5">
                                <strong class="text-bicor">Last Updated:</strong>
                            </div>
                            <div class="col-md-7">
                                <span class="text-muted">{{ policy.UpdatedOn or 'Never' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                {% if policy.Description %}
                <hr>
                <h6 class="text-bicor mb-3 border-bottom pb-2">Description</h6>
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light p-3 rounded">
                            {{ policy.Description }}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <div class="d-flex gap-2">
        <a href="{{ url_for('edit_policy', policy_id=policy.PolicyID) }}" class="btn btn-warning">
            <i class="fas fa-edit me-2"></i>Edit Policy
        </a>
        <form action="{{ url_for('delete_policy', policy_id=policy.PolicyID) }}" method="post" class="d-inline">
            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this policy? This action cannot be undone.')">
                <i class="fas fa-trash me-2"></i>Delete Policy
            </button>
        </form>
        <a href="{{ url_for('client_policies', client_id=policy.ClientID) }}" class="btn btn-secondary">            <i class="fas fa-arrow-left me-2"></i>Back to Policies
        </a>
    </div>
</div>

<!-- Add this section to the action buttons area -->
{% if policy.ProductName == 'INCENDIE' %}
<div class="mt-3">
    <h6 class="text-bicor mb-2">INCENDIE Parameters</h6>
    <a href="{{ url_for('policy_parameters', policy_id=policy.PolicyID) }}" class="btn btn-info">
        <i class="fas fa-cog me-2"></i>View Parameters
    </a>
    <a href="{{ url_for('edit_policy_parameters', policy_id=policy.PolicyID) }}" class="btn btn-warning">
        <i class="fas fa-edit me-2"></i>Edit Parameters
    </a>
</div>
{% endif %}
{% endblock %}